{"ast":null,"code":"/*\n * Copyright (c) 2016-present Invertase Limited & Contributors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this library except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\nimport { isString } from '@react-native-firebase/app/lib/common';\nimport FirebaseApp from '../../FirebaseApp';\nimport SDK_VERSION from '../../version';\nimport { DEFAULT_APP_NAME, KNOWN_NAMESPACES } from '../constants';\nimport FirebaseModule from '../FirebaseModule';\nimport { getApp, getApps, initializeApp, setLogLevel, setOnAppCreate, setOnAppDestroy } from './app'; // firebase.X\n\nlet FIREBASE_ROOT = null;\nconst NAMESPACE_REGISTRY = {};\nconst APP_MODULE_INSTANCE = {};\nconst MODULE_GETTER_FOR_APP = {};\nconst MODULE_GETTER_FOR_ROOT = {};\n/**\n * Attaches module namespace getters on every newly created app.\n *\n * Structured like this to avoid metro require cycles.\n */\n\nsetOnAppCreate(app => {\n  for (let i = 0; i < KNOWN_NAMESPACES.length; i++) {\n    const moduleNamespace = KNOWN_NAMESPACES[i];\n    Object.defineProperty(app, moduleNamespace, {\n      enumerable: false,\n      get: firebaseAppModuleProxy.bind(null, app, moduleNamespace)\n    });\n  }\n});\n/**\n * Destroys all APP_MODULE_INSTANCE & MODULE_GETTER_FOR_APP objects relating to the\n * recently destroyed app.\n *\n * Structured like this to avoid metro require cycles.\n */\n\nsetOnAppDestroy(app => {\n  delete APP_MODULE_INSTANCE[app.name];\n  delete MODULE_GETTER_FOR_APP[app.name];\n});\n/**\n *\n * @param app\n * @param moduleNamespace\n * @returns {*}\n */\n\nfunction getOrCreateModuleForApp(app, moduleNamespace) {\n  if (MODULE_GETTER_FOR_APP[app.name] && MODULE_GETTER_FOR_APP[app.name][moduleNamespace]) {\n    return MODULE_GETTER_FOR_APP[app.name][moduleNamespace];\n  }\n\n  if (!MODULE_GETTER_FOR_APP[app.name]) {\n    MODULE_GETTER_FOR_APP[app.name] = {};\n  }\n\n  const {\n    hasCustomUrlOrRegionSupport,\n    hasMultiAppSupport,\n    ModuleClass\n  } = NAMESPACE_REGISTRY[moduleNamespace]; // modules such as analytics only run on the default app\n\n  if (!hasMultiAppSupport && app.name !== DEFAULT_APP_NAME) {\n    throw new Error([`You attempted to call \"firebase.app('${app.name}').${moduleNamespace}\" but; ${moduleNamespace} does not support multiple Firebase Apps.`, '', `Ensure you access ${moduleNamespace} from the default application only.`].join('\\r\\n'));\n  } // e.g. firebase.storage(customUrlOrRegion)\n\n\n  function firebaseModuleWithArgs(customUrlOrRegion) {\n    if (customUrlOrRegion !== undefined) {\n      if (!hasCustomUrlOrRegionSupport) {// TODO throw Module does not support arguments error\n      }\n\n      if (!isString(customUrlOrRegion)) {// TODO throw Module first argument must be a string error\n      }\n    }\n\n    const key = customUrlOrRegion ? `${customUrlOrRegion}:${moduleNamespace}` : moduleNamespace;\n\n    if (!APP_MODULE_INSTANCE[app.name]) {\n      APP_MODULE_INSTANCE[app.name] = {};\n    }\n\n    if (!APP_MODULE_INSTANCE[app.name][key]) {\n      APP_MODULE_INSTANCE[app.name][key] = new ModuleClass(app, NAMESPACE_REGISTRY[moduleNamespace], customUrlOrRegion);\n    }\n\n    return APP_MODULE_INSTANCE[app.name][key];\n  }\n\n  MODULE_GETTER_FOR_APP[app.name][moduleNamespace] = firebaseModuleWithArgs;\n  return MODULE_GETTER_FOR_APP[app.name][moduleNamespace];\n}\n/**\n *\n * @param moduleNamespace\n * @returns {*}\n */\n\n\nfunction getOrCreateModuleForRoot(moduleNamespace) {\n  if (MODULE_GETTER_FOR_ROOT[moduleNamespace]) {\n    return MODULE_GETTER_FOR_ROOT[moduleNamespace];\n  }\n\n  const {\n    statics,\n    hasMultiAppSupport,\n    ModuleClass\n  } = NAMESPACE_REGISTRY[moduleNamespace]; // e.g. firebase.storage(app)\n\n  function firebaseModuleWithApp(app) {\n    const _app = app || getApp();\n\n    if (!(_app instanceof FirebaseApp)) {\n      throw new Error([`\"firebase.${moduleNamespace}(app)\" arg expects a FirebaseApp instance or undefined.`, '', 'Ensure the arg provided is a Firebase app instance; or no args to use the default Firebase app.'].join('\\r\\n'));\n    } // modules such as analytics only run on the default app\n\n\n    if (!hasMultiAppSupport && _app.name !== DEFAULT_APP_NAME) {\n      throw new Error([`You attempted to call \"firebase.${moduleNamespace}(app)\" but; ${moduleNamespace} does not support multiple Firebase Apps.`, '', `Ensure the app provided is the default Firebase app only and not the \"${_app.name}\" app.`].join('\\r\\n'));\n    }\n\n    if (!APP_MODULE_INSTANCE[_app.name]) {\n      APP_MODULE_INSTANCE[_app.name] = {};\n    }\n\n    if (!APP_MODULE_INSTANCE[_app.name][moduleNamespace]) {\n      APP_MODULE_INSTANCE[_app.name][moduleNamespace] = new ModuleClass(_app, NAMESPACE_REGISTRY[moduleNamespace]);\n    }\n\n    return APP_MODULE_INSTANCE[_app.name][moduleNamespace];\n  }\n\n  Object.assign(firebaseModuleWithApp, statics || {});\n  Object.freeze(firebaseModuleWithApp);\n  MODULE_GETTER_FOR_ROOT[moduleNamespace] = firebaseModuleWithApp;\n  return MODULE_GETTER_FOR_ROOT[moduleNamespace];\n}\n/**\n *\n * @param firebaseNamespace\n * @param moduleNamespace\n * @returns {*}\n */\n\n\nfunction firebaseRootModuleProxy(firebaseNamespace, moduleNamespace) {\n  if (NAMESPACE_REGISTRY[moduleNamespace]) {\n    return getOrCreateModuleForRoot(moduleNamespace);\n  }\n\n  moduleWithDashes = moduleNamespace.split(/(?=[A-Z])/).join('-').toLowerCase();\n  throw new Error([`You attempted to use 'firebase.${moduleNamespace}' but this module could not be found.`, '', `Ensure you have installed and imported the '@react-native-firebase/${moduleWithDashes}' package.`].join('\\r\\n'));\n}\n/**\n *\n * @param app\n * @param moduleNamespace\n * @returns {*}\n */\n\n\nexport function firebaseAppModuleProxy(app, moduleNamespace) {\n  if (NAMESPACE_REGISTRY[moduleNamespace]) {\n    app._checkDestroyed();\n\n    return getOrCreateModuleForApp(app, moduleNamespace);\n  }\n\n  moduleWithDashes = moduleNamespace.split(/(?=[A-Z])/).join('-').toLowerCase();\n  throw new Error([`You attempted to use \"firebase.app('${app.name}').${moduleNamespace}\" but this module could not be found.`, '', `Ensure you have installed and imported the '@react-native-firebase/${moduleWithDashes}' package.`].join('\\r\\n'));\n}\n/**\n *\n * @returns {*}\n */\n\nexport function createFirebaseRoot() {\n  FIREBASE_ROOT = {\n    initializeApp,\n\n    get app() {\n      return getApp;\n    },\n\n    get apps() {\n      return getApps();\n    },\n\n    SDK_VERSION,\n    setLogLevel\n  };\n\n  for (let i = 0; i < KNOWN_NAMESPACES.length; i++) {\n    const namespace = KNOWN_NAMESPACES[i];\n    Object.defineProperty(FIREBASE_ROOT, namespace, {\n      enumerable: false,\n      get: firebaseRootModuleProxy.bind(null, FIREBASE_ROOT, namespace)\n    });\n  }\n\n  return FIREBASE_ROOT;\n}\n/**\n *\n * @returns {*}\n */\n\nexport function getFirebaseRoot() {\n  if (FIREBASE_ROOT) {\n    return FIREBASE_ROOT;\n  }\n\n  return createFirebaseRoot();\n}\n/**\n *\n * @param options\n * @returns {*}\n */\n\nexport function createModuleNamespace() {\n  let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  const {\n    namespace,\n    ModuleClass\n  } = options;\n\n  if (!NAMESPACE_REGISTRY[namespace]) {\n    // validation only for internal / module dev usage\n    if (FirebaseModule.__extended__ !== ModuleClass.__extended__) {\n      throw new Error('INTERNAL ERROR: ModuleClass must be an instance of FirebaseModule.');\n    }\n\n    NAMESPACE_REGISTRY[namespace] = Object.assign({}, options);\n  }\n\n  return getFirebaseRoot()[namespace];\n}","map":{"version":3,"sources":["/Users/jeremyranguis/greatwanderline/package/firebase-jwt/node_modules/@react-native-firebase/app/lib/internal/registry/namespace.js"],"names":["isString","FirebaseApp","SDK_VERSION","DEFAULT_APP_NAME","KNOWN_NAMESPACES","FirebaseModule","getApp","getApps","initializeApp","setLogLevel","setOnAppCreate","setOnAppDestroy","FIREBASE_ROOT","NAMESPACE_REGISTRY","APP_MODULE_INSTANCE","MODULE_GETTER_FOR_APP","MODULE_GETTER_FOR_ROOT","app","i","length","moduleNamespace","Object","defineProperty","enumerable","get","firebaseAppModuleProxy","bind","name","getOrCreateModuleForApp","hasCustomUrlOrRegionSupport","hasMultiAppSupport","ModuleClass","Error","join","firebaseModuleWithArgs","customUrlOrRegion","undefined","key","getOrCreateModuleForRoot","statics","firebaseModuleWithApp","_app","assign","freeze","firebaseRootModuleProxy","firebaseNamespace","moduleWithDashes","split","toLowerCase","_checkDestroyed","createFirebaseRoot","apps","namespace","getFirebaseRoot","createModuleNamespace","options","__extended__"],"mappings":"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","sourcesContent":["/*\n * Copyright (c) 2016-present Invertase Limited & Contributors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this library except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n\nimport { isString } from '@react-native-firebase/app/lib/common';\nimport FirebaseApp from '../../FirebaseApp';\nimport SDK_VERSION from '../../version';\nimport { DEFAULT_APP_NAME, KNOWN_NAMESPACES } from '../constants';\nimport FirebaseModule from '../FirebaseModule';\nimport {\n  getApp,\n  getApps,\n  initializeApp,\n  setLogLevel,\n  setOnAppCreate,\n  setOnAppDestroy,\n} from './app';\n\n// firebase.X\nlet FIREBASE_ROOT = null;\n\nconst NAMESPACE_REGISTRY = {};\nconst APP_MODULE_INSTANCE = {};\nconst MODULE_GETTER_FOR_APP = {};\nconst MODULE_GETTER_FOR_ROOT = {};\n\n/**\n * Attaches module namespace getters on every newly created app.\n *\n * Structured like this to avoid metro require cycles.\n */\nsetOnAppCreate(app => {\n  for (let i = 0; i < KNOWN_NAMESPACES.length; i++) {\n    const moduleNamespace = KNOWN_NAMESPACES[i];\n    Object.defineProperty(app, moduleNamespace, {\n      enumerable: false,\n      get: firebaseAppModuleProxy.bind(null, app, moduleNamespace),\n    });\n  }\n});\n\n/**\n * Destroys all APP_MODULE_INSTANCE & MODULE_GETTER_FOR_APP objects relating to the\n * recently destroyed app.\n *\n * Structured like this to avoid metro require cycles.\n */\nsetOnAppDestroy(app => {\n  delete APP_MODULE_INSTANCE[app.name];\n  delete MODULE_GETTER_FOR_APP[app.name];\n});\n\n/**\n *\n * @param app\n * @param moduleNamespace\n * @returns {*}\n */\nfunction getOrCreateModuleForApp(app, moduleNamespace) {\n  if (MODULE_GETTER_FOR_APP[app.name] && MODULE_GETTER_FOR_APP[app.name][moduleNamespace]) {\n    return MODULE_GETTER_FOR_APP[app.name][moduleNamespace];\n  }\n\n  if (!MODULE_GETTER_FOR_APP[app.name]) {\n    MODULE_GETTER_FOR_APP[app.name] = {};\n  }\n\n  const { hasCustomUrlOrRegionSupport, hasMultiAppSupport, ModuleClass } =\n    NAMESPACE_REGISTRY[moduleNamespace];\n\n  // modules such as analytics only run on the default app\n  if (!hasMultiAppSupport && app.name !== DEFAULT_APP_NAME) {\n    throw new Error(\n      [\n        `You attempted to call \"firebase.app('${app.name}').${moduleNamespace}\" but; ${moduleNamespace} does not support multiple Firebase Apps.`,\n        '',\n        `Ensure you access ${moduleNamespace} from the default application only.`,\n      ].join('\\r\\n'),\n    );\n  }\n\n  // e.g. firebase.storage(customUrlOrRegion)\n  function firebaseModuleWithArgs(customUrlOrRegion) {\n    if (customUrlOrRegion !== undefined) {\n      if (!hasCustomUrlOrRegionSupport) {\n        // TODO throw Module does not support arguments error\n      }\n\n      if (!isString(customUrlOrRegion)) {\n        // TODO throw Module first argument must be a string error\n      }\n    }\n\n    const key = customUrlOrRegion ? `${customUrlOrRegion}:${moduleNamespace}` : moduleNamespace;\n\n    if (!APP_MODULE_INSTANCE[app.name]) {\n      APP_MODULE_INSTANCE[app.name] = {};\n    }\n\n    if (!APP_MODULE_INSTANCE[app.name][key]) {\n      APP_MODULE_INSTANCE[app.name][key] = new ModuleClass(\n        app,\n        NAMESPACE_REGISTRY[moduleNamespace],\n        customUrlOrRegion,\n      );\n    }\n\n    return APP_MODULE_INSTANCE[app.name][key];\n  }\n\n  MODULE_GETTER_FOR_APP[app.name][moduleNamespace] = firebaseModuleWithArgs;\n  return MODULE_GETTER_FOR_APP[app.name][moduleNamespace];\n}\n\n/**\n *\n * @param moduleNamespace\n * @returns {*}\n */\nfunction getOrCreateModuleForRoot(moduleNamespace) {\n  if (MODULE_GETTER_FOR_ROOT[moduleNamespace]) {\n    return MODULE_GETTER_FOR_ROOT[moduleNamespace];\n  }\n\n  const { statics, hasMultiAppSupport, ModuleClass } = NAMESPACE_REGISTRY[moduleNamespace];\n\n  // e.g. firebase.storage(app)\n  function firebaseModuleWithApp(app) {\n    const _app = app || getApp();\n\n    if (!(_app instanceof FirebaseApp)) {\n      throw new Error(\n        [\n          `\"firebase.${moduleNamespace}(app)\" arg expects a FirebaseApp instance or undefined.`,\n          '',\n          'Ensure the arg provided is a Firebase app instance; or no args to use the default Firebase app.',\n        ].join('\\r\\n'),\n      );\n    }\n\n    // modules such as analytics only run on the default app\n    if (!hasMultiAppSupport && _app.name !== DEFAULT_APP_NAME) {\n      throw new Error(\n        [\n          `You attempted to call \"firebase.${moduleNamespace}(app)\" but; ${moduleNamespace} does not support multiple Firebase Apps.`,\n          '',\n          `Ensure the app provided is the default Firebase app only and not the \"${_app.name}\" app.`,\n        ].join('\\r\\n'),\n      );\n    }\n\n    if (!APP_MODULE_INSTANCE[_app.name]) {\n      APP_MODULE_INSTANCE[_app.name] = {};\n    }\n\n    if (!APP_MODULE_INSTANCE[_app.name][moduleNamespace]) {\n      APP_MODULE_INSTANCE[_app.name][moduleNamespace] = new ModuleClass(\n        _app,\n        NAMESPACE_REGISTRY[moduleNamespace],\n      );\n    }\n\n    return APP_MODULE_INSTANCE[_app.name][moduleNamespace];\n  }\n\n  Object.assign(firebaseModuleWithApp, statics || {});\n  Object.freeze(firebaseModuleWithApp);\n  MODULE_GETTER_FOR_ROOT[moduleNamespace] = firebaseModuleWithApp;\n\n  return MODULE_GETTER_FOR_ROOT[moduleNamespace];\n}\n\n/**\n *\n * @param firebaseNamespace\n * @param moduleNamespace\n * @returns {*}\n */\nfunction firebaseRootModuleProxy(firebaseNamespace, moduleNamespace) {\n  if (NAMESPACE_REGISTRY[moduleNamespace]) {\n    return getOrCreateModuleForRoot(moduleNamespace);\n  }\n\n  moduleWithDashes = moduleNamespace\n    .split(/(?=[A-Z])/)\n    .join('-')\n    .toLowerCase();\n\n  throw new Error(\n    [\n      `You attempted to use 'firebase.${moduleNamespace}' but this module could not be found.`,\n      '',\n      `Ensure you have installed and imported the '@react-native-firebase/${moduleWithDashes}' package.`,\n    ].join('\\r\\n'),\n  );\n}\n\n/**\n *\n * @param app\n * @param moduleNamespace\n * @returns {*}\n */\nexport function firebaseAppModuleProxy(app, moduleNamespace) {\n  if (NAMESPACE_REGISTRY[moduleNamespace]) {\n    app._checkDestroyed();\n    return getOrCreateModuleForApp(app, moduleNamespace);\n  }\n\n  moduleWithDashes = moduleNamespace\n    .split(/(?=[A-Z])/)\n    .join('-')\n    .toLowerCase();\n\n  throw new Error(\n    [\n      `You attempted to use \"firebase.app('${app.name}').${moduleNamespace}\" but this module could not be found.`,\n      '',\n      `Ensure you have installed and imported the '@react-native-firebase/${moduleWithDashes}' package.`,\n    ].join('\\r\\n'),\n  );\n}\n\n/**\n *\n * @returns {*}\n */\nexport function createFirebaseRoot() {\n  FIREBASE_ROOT = {\n    initializeApp,\n    get app() {\n      return getApp;\n    },\n    get apps() {\n      return getApps();\n    },\n    SDK_VERSION,\n    setLogLevel,\n  };\n\n  for (let i = 0; i < KNOWN_NAMESPACES.length; i++) {\n    const namespace = KNOWN_NAMESPACES[i];\n    Object.defineProperty(FIREBASE_ROOT, namespace, {\n      enumerable: false,\n      get: firebaseRootModuleProxy.bind(null, FIREBASE_ROOT, namespace),\n    });\n  }\n\n  return FIREBASE_ROOT;\n}\n\n/**\n *\n * @returns {*}\n */\nexport function getFirebaseRoot() {\n  if (FIREBASE_ROOT) {\n    return FIREBASE_ROOT;\n  }\n  return createFirebaseRoot();\n}\n\n/**\n *\n * @param options\n * @returns {*}\n */\nexport function createModuleNamespace(options = {}) {\n  const { namespace, ModuleClass } = options;\n\n  if (!NAMESPACE_REGISTRY[namespace]) {\n    // validation only for internal / module dev usage\n    if (FirebaseModule.__extended__ !== ModuleClass.__extended__) {\n      throw new Error('INTERNAL ERROR: ModuleClass must be an instance of FirebaseModule.');\n    }\n\n    NAMESPACE_REGISTRY[namespace] = Object.assign({}, options);\n  }\n\n  return getFirebaseRoot()[namespace];\n}\n"]},"metadata":{},"sourceType":"module"}