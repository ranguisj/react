{"ast":null,"code":"/*\n * Copyright (c) 2016-present Invertase Limited & Contributors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this library except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\nimport { isArray, isBoolean, isDate, isNull, isNumber, isObject, isString, isUndefined } from '@react-native-firebase/app/lib/common';\nimport FirestoreBlob from '../FirestoreBlob';\nimport { DOCUMENT_ID } from '../FirestoreFieldPath';\nimport FirestoreGeoPoint from '../FirestoreGeoPoint';\nimport FirestorePath from '../FirestorePath';\nimport FirestoreTimestamp from '../FirestoreTimestamp';\nimport { getTypeMapInt, getTypeMapName } from './typemap'; // To avoid React Native require cycle warnings\n\nlet FirestoreDocumentReference = null;\nexport function provideDocumentReferenceClass(documentReference) {\n  FirestoreDocumentReference = documentReference;\n}\nlet FirestoreFieldValue = null;\nexport function provideFieldValueClass(fieldValue) {\n  FirestoreFieldValue = fieldValue;\n}\n/**\n *\n * @param data\n * @param ignoreUndefined\n */\n\nexport function buildNativeMap(data, ignoreUndefined) {\n  const nativeData = {};\n\n  if (data) {\n    const keys = Object.keys(data);\n\n    for (let i = 0; i < keys.length; i++) {\n      const key = keys[i];\n\n      if (typeof data[key] === 'undefined') {\n        if (!ignoreUndefined) {\n          throw new Error('Unsupported field value: undefined');\n        } else {\n          continue;\n        }\n      }\n\n      const typeMap = generateNativeData(data[key], ignoreUndefined);\n\n      if (typeMap) {\n        nativeData[key] = typeMap;\n      }\n    }\n  }\n\n  return nativeData;\n}\n/**\n *\n * @param array\n * @returns {Array}\n */\n\nexport function buildNativeArray(array, ignoreUndefined) {\n  const nativeArray = [];\n\n  if (array) {\n    for (let i = 0; i < array.length; i++) {\n      const value = array[i];\n\n      if (typeof value === 'undefined') {\n        if (!ignoreUndefined) {\n          throw new Error('Unsupported field value: undefined');\n        } else {\n          continue;\n        }\n      }\n\n      const typeMap = generateNativeData(value, ignoreUndefined);\n\n      if (typeMap) {\n        nativeArray.push(typeMap);\n      }\n    }\n  }\n\n  return nativeArray;\n}\n/**\n * Creates a lightweight array of an object value to be sent over the bridge.\n * The type is convered to an integer which is handled on the native side\n * to create the correct types.\n *\n * Example: [7, 'some string'];\n *\n * @param value\n * @param ignoreUndefined\n * @returns {*}\n */\n\nexport function generateNativeData(value, ignoreUndefined) {\n  if (Number.isNaN(value)) {\n    return getTypeMapInt('nan');\n  }\n\n  if (value === Number.NEGATIVE_INFINITY) {\n    return getTypeMapInt('-infinity');\n  }\n\n  if (value === Number.POSITIVE_INFINITY) {\n    return getTypeMapInt('infinity');\n  }\n\n  if (isNull(value) || isUndefined(value)) {\n    return getTypeMapInt('null');\n  }\n\n  if (value === DOCUMENT_ID) {\n    return getTypeMapInt('documentid');\n  }\n\n  if (isBoolean(value)) {\n    if (value === true) {\n      return getTypeMapInt('booleanTrue');\n    }\n\n    return getTypeMapInt('booleanFalse');\n  }\n\n  if (isNumber(value)) {\n    // mirror the JS SDK's integer detection algorithm\n    // https://github.com/firebase/firebase-js-sdk/blob/086df7c7e0299cedd9f3cff9080f46ca25cab7cd/packages/firestore/src/remote/number_serializer.ts#L56\n    if (value === 0 && 1 / value === -Infinity) {\n      return getTypeMapInt('negativeZero');\n    }\n\n    if (Number.isSafeInteger(value)) {\n      return getTypeMapInt('integer', value);\n    }\n\n    return getTypeMapInt('double', value);\n  }\n\n  if (isString(value)) {\n    if (value === '') {\n      return getTypeMapInt('stringEmpty');\n    }\n\n    return getTypeMapInt('string', value);\n  }\n\n  if (isArray(value)) {\n    return getTypeMapInt('array', buildNativeArray(value, ignoreUndefined));\n  }\n\n  if (isObject(value)) {\n    if (value instanceof FirestoreDocumentReference) {\n      return getTypeMapInt('reference', value.path);\n    }\n\n    if (value instanceof FirestoreGeoPoint) {\n      return getTypeMapInt('geopoint', [value.latitude, value.longitude]);\n    } // Handle Date objects are Timestamps as per web sdk\n\n\n    if (isDate(value)) {\n      const timestamp = FirestoreTimestamp.fromDate(value);\n      return getTypeMapInt('timestamp', [timestamp.seconds, timestamp.nanoseconds]);\n    }\n\n    if (value instanceof FirestoreTimestamp) {\n      return getTypeMapInt('timestamp', [value.seconds, value.nanoseconds]);\n    }\n\n    if (value instanceof FirestoreBlob) {\n      return getTypeMapInt('blob', value.toBase64());\n    }\n\n    if (value instanceof FirestoreFieldValue) {\n      return getTypeMapInt('fieldvalue', [value._type, value._elements]);\n    }\n\n    return getTypeMapInt('object', buildNativeMap(value, ignoreUndefined));\n  } // eslint-disable-next-line no-console\n\n\n  console.warn(`Unknown data type received ${value}`);\n  return getTypeMapInt('unknown');\n}\n/**\n *\n * @param firestore\n * @param nativeData\n */\n\nexport function parseNativeMap(firestore, nativeData) {\n  let data;\n\n  if (nativeData) {\n    data = {};\n    const entries = Object.entries(nativeData);\n\n    for (let i = 0; i < entries.length; i++) {\n      const [key, typeArray] = entries[i];\n      data[key] = parseNativeData(firestore, typeArray);\n    }\n  }\n\n  return data;\n}\n/**\n *\n * @param firestore\n * @param nativeArray\n * @returns {Array}\n */\n\nexport function parseNativeArray(firestore, nativeArray) {\n  const array = [];\n\n  if (nativeArray) {\n    for (let i = 0; i < nativeArray.length; i++) {\n      array.push(parseNativeData(firestore, nativeArray[i]));\n    }\n  }\n\n  return array;\n}\n/**\n * Data returned from native is constructed in the same way it sent to keep\n * payloads over the bridge as small as possible. The index matches to a type\n * which is then created on JS land.\n *\n * Example: [7, 'string']\n *\n * @param firestore\n * @param nativeArray\n * @returns *\n */\n\nexport function parseNativeData(firestore, nativeArray) {\n  const [int, value] = nativeArray;\n  const type = getTypeMapName(int);\n\n  switch (type) {\n    case 'nan':\n      return NaN;\n\n    case '-infinity':\n      return -Infinity;\n\n    case 'infinity':\n      return Infinity;\n\n    case 'null':\n      return null;\n\n    case 'booleanTrue':\n      return true;\n\n    case 'booleanFalse':\n      return false;\n\n    case 'double':\n    case 'integer':\n    case 'negativeZero':\n    case 'string':\n      return value;\n\n    case 'stringEmpty':\n      return '';\n\n    case 'array':\n      return parseNativeArray(firestore, value);\n\n    case 'object':\n      return parseNativeMap(firestore, value);\n\n    case 'reference':\n      return new FirestoreDocumentReference(firestore, FirestorePath.fromName(value));\n\n    case 'geopoint':\n      return new FirestoreGeoPoint(value[0], value[1]);\n\n    case 'timestamp':\n      return new FirestoreTimestamp(value[0], value[1]);\n\n    case 'blob':\n      return FirestoreBlob.fromBase64String(value);\n\n    default:\n      // eslint-disable-next-line no-console\n      console.warn(`Unknown data type received from native channel: ${type}`);\n      return value;\n  }\n}","map":{"version":3,"sources":["/Users/jeremyranguis/greatwanderline/package/firebase-jwt/node_modules/@react-native-firebase/firestore/lib/utils/serialize.js"],"names":["isArray","isBoolean","isDate","isNull","isNumber","isObject","isString","isUndefined","FirestoreBlob","DOCUMENT_ID","FirestoreGeoPoint","FirestorePath","FirestoreTimestamp","getTypeMapInt","getTypeMapName","FirestoreDocumentReference","provideDocumentReferenceClass","documentReference","FirestoreFieldValue","provideFieldValueClass","fieldValue","buildNativeMap","data","ignoreUndefined","nativeData","keys","Object","i","length","key","Error","typeMap","generateNativeData","buildNativeArray","array","nativeArray","value","push","Number","isNaN","NEGATIVE_INFINITY","POSITIVE_INFINITY","Infinity","isSafeInteger","path","latitude","longitude","timestamp","fromDate","seconds","nanoseconds","toBase64","_type","_elements","console","warn","parseNativeMap","firestore","entries","typeArray","parseNativeData","parseNativeArray","int","type","NaN","fromName","fromBase64String"],"mappings":"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","sourcesContent":["/*\n * Copyright (c) 2016-present Invertase Limited & Contributors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this library except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n\nimport {\n  isArray,\n  isBoolean,\n  isDate,\n  isNull,\n  isNumber,\n  isObject,\n  isString,\n  isUndefined,\n} from '@react-native-firebase/app/lib/common';\nimport FirestoreBlob from '../FirestoreBlob';\nimport { DOCUMENT_ID } from '../FirestoreFieldPath';\nimport FirestoreGeoPoint from '../FirestoreGeoPoint';\nimport FirestorePath from '../FirestorePath';\nimport FirestoreTimestamp from '../FirestoreTimestamp';\nimport { getTypeMapInt, getTypeMapName } from './typemap';\n\n// To avoid React Native require cycle warnings\nlet FirestoreDocumentReference = null;\nexport function provideDocumentReferenceClass(documentReference) {\n  FirestoreDocumentReference = documentReference;\n}\n\nlet FirestoreFieldValue = null;\nexport function provideFieldValueClass(fieldValue) {\n  FirestoreFieldValue = fieldValue;\n}\n\n/**\n *\n * @param data\n * @param ignoreUndefined\n */\nexport function buildNativeMap(data, ignoreUndefined) {\n  const nativeData = {};\n  if (data) {\n    const keys = Object.keys(data);\n    for (let i = 0; i < keys.length; i++) {\n      const key = keys[i];\n\n      if (typeof data[key] === 'undefined') {\n        if (!ignoreUndefined) {\n          throw new Error('Unsupported field value: undefined');\n        } else {\n          continue;\n        }\n      }\n\n      const typeMap = generateNativeData(data[key], ignoreUndefined);\n      if (typeMap) {\n        nativeData[key] = typeMap;\n      }\n    }\n  }\n  return nativeData;\n}\n\n/**\n *\n * @param array\n * @returns {Array}\n */\nexport function buildNativeArray(array, ignoreUndefined) {\n  const nativeArray = [];\n  if (array) {\n    for (let i = 0; i < array.length; i++) {\n      const value = array[i];\n      if (typeof value === 'undefined') {\n        if (!ignoreUndefined) {\n          throw new Error('Unsupported field value: undefined');\n        } else {\n          continue;\n        }\n      }\n      const typeMap = generateNativeData(value, ignoreUndefined);\n      if (typeMap) {\n        nativeArray.push(typeMap);\n      }\n    }\n  }\n  return nativeArray;\n}\n\n/**\n * Creates a lightweight array of an object value to be sent over the bridge.\n * The type is convered to an integer which is handled on the native side\n * to create the correct types.\n *\n * Example: [7, 'some string'];\n *\n * @param value\n * @param ignoreUndefined\n * @returns {*}\n */\nexport function generateNativeData(value, ignoreUndefined) {\n  if (Number.isNaN(value)) {\n    return getTypeMapInt('nan');\n  }\n\n  if (value === Number.NEGATIVE_INFINITY) {\n    return getTypeMapInt('-infinity');\n  }\n\n  if (value === Number.POSITIVE_INFINITY) {\n    return getTypeMapInt('infinity');\n  }\n\n  if (isNull(value) || isUndefined(value)) {\n    return getTypeMapInt('null');\n  }\n\n  if (value === DOCUMENT_ID) {\n    return getTypeMapInt('documentid');\n  }\n\n  if (isBoolean(value)) {\n    if (value === true) {\n      return getTypeMapInt('booleanTrue');\n    }\n    return getTypeMapInt('booleanFalse');\n  }\n\n  if (isNumber(value)) {\n    // mirror the JS SDK's integer detection algorithm\n    // https://github.com/firebase/firebase-js-sdk/blob/086df7c7e0299cedd9f3cff9080f46ca25cab7cd/packages/firestore/src/remote/number_serializer.ts#L56\n    if (value === 0 && 1 / value === -Infinity) {\n      return getTypeMapInt('negativeZero');\n    }\n    if (Number.isSafeInteger(value)) {\n      return getTypeMapInt('integer', value);\n    }\n    return getTypeMapInt('double', value);\n  }\n\n  if (isString(value)) {\n    if (value === '') {\n      return getTypeMapInt('stringEmpty');\n    }\n    return getTypeMapInt('string', value);\n  }\n\n  if (isArray(value)) {\n    return getTypeMapInt('array', buildNativeArray(value, ignoreUndefined));\n  }\n\n  if (isObject(value)) {\n    if (value instanceof FirestoreDocumentReference) {\n      return getTypeMapInt('reference', value.path);\n    }\n\n    if (value instanceof FirestoreGeoPoint) {\n      return getTypeMapInt('geopoint', [value.latitude, value.longitude]);\n    }\n\n    // Handle Date objects are Timestamps as per web sdk\n    if (isDate(value)) {\n      const timestamp = FirestoreTimestamp.fromDate(value);\n      return getTypeMapInt('timestamp', [timestamp.seconds, timestamp.nanoseconds]);\n    }\n\n    if (value instanceof FirestoreTimestamp) {\n      return getTypeMapInt('timestamp', [value.seconds, value.nanoseconds]);\n    }\n\n    if (value instanceof FirestoreBlob) {\n      return getTypeMapInt('blob', value.toBase64());\n    }\n\n    if (value instanceof FirestoreFieldValue) {\n      return getTypeMapInt('fieldvalue', [value._type, value._elements]);\n    }\n\n    return getTypeMapInt('object', buildNativeMap(value, ignoreUndefined));\n  }\n\n  // eslint-disable-next-line no-console\n  console.warn(`Unknown data type received ${value}`);\n\n  return getTypeMapInt('unknown');\n}\n\n/**\n *\n * @param firestore\n * @param nativeData\n */\nexport function parseNativeMap(firestore, nativeData) {\n  let data;\n  if (nativeData) {\n    data = {};\n    const entries = Object.entries(nativeData);\n    for (let i = 0; i < entries.length; i++) {\n      const [key, typeArray] = entries[i];\n      data[key] = parseNativeData(firestore, typeArray);\n    }\n  }\n  return data;\n}\n\n/**\n *\n * @param firestore\n * @param nativeArray\n * @returns {Array}\n */\nexport function parseNativeArray(firestore, nativeArray) {\n  const array = [];\n  if (nativeArray) {\n    for (let i = 0; i < nativeArray.length; i++) {\n      array.push(parseNativeData(firestore, nativeArray[i]));\n    }\n  }\n  return array;\n}\n\n/**\n * Data returned from native is constructed in the same way it sent to keep\n * payloads over the bridge as small as possible. The index matches to a type\n * which is then created on JS land.\n *\n * Example: [7, 'string']\n *\n * @param firestore\n * @param nativeArray\n * @returns *\n */\nexport function parseNativeData(firestore, nativeArray) {\n  const [int, value] = nativeArray;\n  const type = getTypeMapName(int);\n\n  switch (type) {\n    case 'nan':\n      return NaN;\n    case '-infinity':\n      return -Infinity;\n    case 'infinity':\n      return Infinity;\n    case 'null':\n      return null;\n    case 'booleanTrue':\n      return true;\n    case 'booleanFalse':\n      return false;\n    case 'double':\n    case 'integer':\n    case 'negativeZero':\n    case 'string':\n      return value;\n    case 'stringEmpty':\n      return '';\n    case 'array':\n      return parseNativeArray(firestore, value);\n    case 'object':\n      return parseNativeMap(firestore, value);\n    case 'reference':\n      return new FirestoreDocumentReference(firestore, FirestorePath.fromName(value));\n    case 'geopoint':\n      return new FirestoreGeoPoint(value[0], value[1]);\n    case 'timestamp':\n      return new FirestoreTimestamp(value[0], value[1]);\n    case 'blob':\n      return FirestoreBlob.fromBase64String(value);\n    default:\n      // eslint-disable-next-line no-console\n      console.warn(`Unknown data type received from native channel: ${type}`);\n      return value;\n  }\n}\n"]},"metadata":{},"sourceType":"module"}